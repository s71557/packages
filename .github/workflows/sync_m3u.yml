name: Sync M3U Directory

on:
  schedule:
    - cron: '0 0 * * *'  # Runs at 00:00 UTC every day
  workflow_dispatch:  # Allows manual trigger

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Create m3u directory if it doesn't exist
      run: mkdir -p tv/m3u

    - name: Sync m3u files
      run: |
        cd tv/m3u
        for file in ipv6.m3u global.m3u iptv.m3u; do
          curl -O "https://raw.githubusercontent.com/fanmingming/live/main/tv/m3u/$file"
        done

    - name: Check for changes
      id: check_changes
      run: |
        git status --porcelain tv/m3u | grep . && echo "changes=true" >> $GITHUB_OUTPUT || echo "No changes"

    - name: Commit and push if changed
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add tv/m3u
        git commit -m "Sync m3u files from fanmingming/live"
        git push
